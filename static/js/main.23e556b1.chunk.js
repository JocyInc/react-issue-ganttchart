(this["webpackJsonpreact-issue-ganttchart"]=this["webpackJsonpreact-issue-ganttchart"]||[]).push([[0],{115:function(e,t,n){},120:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(10),u=n.n(o),c=n(51),i=n(11),l=(n(81),n(27)),s=n(31),d=n(67),f=n(4),p=n(156),g=n(65),h=n.n(g),m=n(157),b=n(122),v=n(155),_=n(64),k={multiselectContainer:{width:"50%",display:"inline-block",verticalAlign:"middle",padding:"4px",alignItems:"flex-end"},chips:{background:"light blue",fontSize:"15px"},searchBox:{border:"none"}},w=Object(f.a)((function(e){return{root:{"& > *":{margin:e.spacing(1),fontSize:"15px"}}}}))((function(e){var t=e.classes;return r.a.createElement("form",{noValidate:!0,onSubmit:e.handleSubmit},r.a.createElement(m.a,{className:t.root,required:!0,placeholder:"https://github.com/lamact/react-issue-ganttchart",label:"Git Repository URL",style:{width:"25%",verticalAlign:"middle"},onChange:function(t){e.onGitURLChange(t.target.value)},inputRef:e.register,name:"git_url"}),r.a.createElement(m.a,{className:t.root,type:"password",placeholder:"Access Token",defaultValue:"Access Token",label:"Access Token",style:{width:"10%",verticalAlign:"middle"},onChange:function(t){e.onTokenChange(t.target.value)}}),r.a.createElement(_.Multiselect,{className:t.root,options:e.labels,selectedValues:e.selected_labels,onSelect:function(t){e.onSelectedLabelChange(t)},onRemove:function(t){e.onSelectedLabelChange(t)},displayValue:"name",style:k,placeholder:"filter by labels",hidePlaceholder:"false",emptyRecordMsg:"No Labels",closeIcon:"cancel"}),r.a.createElement(v.a,{size:"small",style:{height:"34px"}},r.a.createElement(b.a,{onClick:function(t){e.onZoomChange("Weeks")}},"Weeks"),r.a.createElement(b.a,{onClick:function(t){e.onZoomChange("Days")}},"Days")),r.a.createElement(p.a,{color:"primary",style:{verticalAlign:"middle"}},r.a.createElement(h.a,{onClick:function(t){e.onUpdateClick()}})))})),y=(n(94),w),j=n(22),C=(n(95),n(7)),D=n.n(C),L=n(15),S=n(48),E=n.n(S),O=function(e){return null!==e&&e!==[]&&void 0!==e},x=function(e,t){var n=new Date(e);return E()(n).add(t-1,"d").toDate().toLocaleDateString("ja-JP")},A=function(e,t,n){return null!=e&&null!=t?e.toLocaleDateString("ja-JP"):new Date(n).toLocaleDateString("ja-JP")},z=function(e,t){return null!=e&&null!=t?function(e,t){var n=E()(e);return E()(t).diff(n,"days")+1}(e,t):1},R=function(e,t){return null==e||null==t},P=function(e,t){var n=[];n.push(e),t(n={data:n,links:[]})},U=function(e){return e.length>1&&/\/$/.test(e)&&(e=e.slice(0,-1)),e},J=function(e){return e.length>1&&/ +$/.test(e)&&(e=e.slice(0,-1)),e},T=function(e){var t=e;return t=U(t),t=J(t),t=U(t),t=J(t)},F=function(e){if(null==e)return null;var t=e.match(/start_date: \d{4}\/\d{1,2}\/\d{1,2}/);return null==t?null:(t=t[0].match(/\d{4}\/\d{1,2}\/\d{1,2}/)[0],new Date(t))},Z=function(e,t){return null!=F(e)?e.replace(/start_date: \d{4}\/\d{1,2}\/\d{1,2}/,"start_date: "+t):"start_date: "+t+"  \n"+e},V=function(e){if(null==e)return null;var t=e.match(/due_date: \d{4}\/\d{1,2}\/\d{1,2}/);return null==t?null:(t=t[0].match(/\d{4}\/\d{1,2}\/\d{1,2}/)[0],new Date(t))},M=function(e){if(null==e)return null;var t=e.match(/progress: \d{1}\.\d{1}/);return null==t?.1:(t=t[0].match(/\d{1}\.\d{1}/)[0],parseFloat(t))},N=function(e,t){var n=M(e),a=Math.round(10*t)/10;return"1"===t&&(t="1.0"),null!=n?e.replace(/progress: \d{1}\.\d{1}/,"progress: "+a):"progress: "+a+"  \n"+e},W=function(e){var t="";return O(e)&&e.map((function(e){return t+=e.id+":"+e.name+",",null})),t},G="https://api.github.com/repos/",I=function(e){return/github\.com/.test(e)},B=function(e){var t=e.split("/");if(t.length>=5)return t[3]},$=function(e){var t=e.split("/");if(t.length>=5)return t[4]},H=function(e,t){var n=T(e);return G+B(n)+"/"+$(n)+"/issues/"+t},Q=function(e,t){var n="";O(t)&&(n+="?labels=",t.map((function(e){return n+=e.name+",",null})));var a=T(e);return G+B(a)+"/"+$(a)+"/issues"+n},Y=function(e){var t=T(e);return G+B(t)+"/"+$(t)+"/labels"},q=function(e){var t=T(e);return G+B(t)+"/"+$(t)+"/collaborators"},K="https://gitlab.com/api/v4/projects/",X=function(e){return/gitlab\.com/.test(e)},ee=function(e){var t=e.split("/");if(t.length>=5)return t[3]},te=function(e){var t=e.split("/");if(t.length>=5)return t[4]},ne=function(e){var t="";return O(e)?t+="?access_token="+e+"&":t+="?",t},ae=function(e,t,n){var a=ne(t);O(n)&&(a+="labels=",n.map((function(e){return a+=e.name+",",null})));var r=T(e);return K+ee(r)+"%2F"+te(r)+"/issues"+a},re=function(e,t){var n=ne(t),a=T(e);return K+ee(a)+"%2F"+te(a)+"/labels"+n},oe=n(20),ue=n.n(oe),ce=function(e,t){var n=F(e),a=V(e);return{id:t.number,text:t.title,start_date:A(n,a,t.created_at),duration:z(n,a),progress:M(e),unscheduled:R(n,a)}},ie=function(e,t){var n=new Date(t.start_date).toLocaleDateString("ja-JP"),a=x(n,t.duration);return e=function(e,t){return null!=V(e)?e.replace(/due_date: \d{4}\/\d{1,2}\/\d{1,2}/,"due_date: "+t):"due_date: "+t+"  \n"+e}(e=N(e,t.progress),a),e=Z(e,n)},le=function(){var e=Object(L.a)(D.a.mark((function e(t,n,a){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ue.a.get(Q(n,a)).then((function(e){e.data.map((function(e){return ue.a.get(H(n,e.number)).then((function(n){var a=ce(n.data.body,e);P(a,t)})),null}))}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),se=function(){var e=Object(L.a)(D.a.mark((function e(t,n,a,r){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O(r)&&"Access Token"!==r?ue.a.get(q(n),{headers:{Authorization:"token ".concat(r)},data:{}}).then((function(e){var n=[];console.log(e.data),e.data.map((function(e){return n.push({id:e.id,name:e.login}),null})),t(a.concat(n))})):r="",ue.a.get(Y(n)).then((function(e){var n=[];console.log(e.data),e.data.map((function(e){return n.push(e),null})),t(a.concat(n))}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),de=function(e,t){window.open(function(e,t){var n=T(e);return"https://github.com/"+B(n)+"/"+$(n)+"/issues/"+t}(t,e),"_blank")},fe=function(e,t){var n="";n+="start_date:%20"+(new Date).toLocaleDateString("ja-JP")+"%0D%0A",n+="due_date:%20"+(new Date).toLocaleDateString("ja-JP")+"%0D%0A",n+="progress:%200.1%0D%0A",window.open(function(e){var t=T(e);return"https://github.com/"+B(t)+"/"+$(t)+"/issues/new?assignees=&labels=&title=&body="}(t)+n,"_blank")},pe=function(e){var t=F(e.description),n=new Date(e.due_date).toLocaleDateString("ja-JP");return{id:e.iid,text:e.title,start_date:A(t,n,e.created_at),duration:z(t,n),progress:M(e.description),unscheduled:R(t,n)}},ge=function(){var e=Object(L.a)(D.a.mark((function e(t,n,a,r){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ue.a.get(ae(n,a,r)).then((function(e){e.data.map((function(e){var n=pe(e);return P(n,t),null}))}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),he=function(){var e=Object(L.a)(D.a.mark((function e(t,n,a){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ue.a.get(re(n,a)).then((function(e){var n=[];e.data.map((function(e){return n.push(e),null})),t(n)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),me=function(e,t,n,a){ue.a.get(function(e,t,n){var a=ne(t),r=T(e);return K+ee(r)+"%2F"+te(r)+"/issues"+a}(a,t)).then((function(r){r.data.map((function(r){if(r.iid===e.id){var o=function(e,t){var n=new Date(t.start_date).toLocaleDateString("ja-JP");return e=N(e,t.progress),e=Z(e,n),encodeURIComponent(e)}(r.description,e),u=new Date(e.start_date).toLocaleDateString("ja-JP"),c=x(u,e.duration),i=function(e,t,n){var a=ne(t),r=T(e);return K+ee(r)+"%2F"+te(r)+"/issues/"+n+a}(a,t,e.id)+"&description="+o+"&due_date="+c;ue.a.put(i).then((function(e){console.log("success update issue")})).catch((function(e){alert("failed update GitLab issue. check your token."),ge(n,a)}))}return null}))}))},be=function(e,t){window.open(function(e,t){var n=T(e);return"https://gitlab.com/"+ee(n)+"/"+te(n)+"/-/issues/"+t}(t,e),"_blank")},ve=function(e,t){var n="";n+="start_date:%20"+(new Date).toLocaleDateString("ja-JP")+"%20%20%0D%0A",n+="progress:%200.1%0D%0A",window.open(function(e){var t=T(e);return"https://gitlab.com/"+ee(t)+"/"+te(t)+"/issues/new?issue[description]="}(t)+n,"_blank")},_e=function(){var e=Object(L.a)(D.a.mark((function e(t,n,a,r){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(n)&&le(t,n,r),X(n)&&ge(t,n,a,r);case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),ke=function(){var e=Object(L.a)(D.a.mark((function e(t,n,a,r){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(n)&&se(t,n,a),X(n)&&he(t,n,r);case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),we=function(e,t,n,a){I(a)&&function(e,t,n,a){var r=H(a,e.id);ue.a.get(r).then((function(o){ue.a.post(r,{body:ie(o.data.body,e)},{headers:{Authorization:"token ".concat(t)}}).then((function(e){console.log("success update issue")})).catch((function(e){alert("failed update GitHub issue. check your token."),le(n,a)}))}))}(e,t,n,a),X(a)&&me(e,t,n,a)},ye={levels:[{name:"Days",scale_height:60,min_column_width:70,scales:[{unit:"week",step:1,format:"%M, %d week"},{unit:"day",step:1,format:"%d %M"}]},{name:"Weeks",scale_height:60,min_column_width:70,scales:[{unit:"month",step:1,format:"%Y %F"},{unit:"week",step:1,format:"%M, %d week"}]}]},je=function(e){e.config.xml_date="%Y/%m/%d %H:%i",e.config.order_branch=!0,e.config.order_branch_free=!0,e.config.keep_grid_width=!0,e.config.grid_resize=!0,e.config.show_unscheduled=!0,e.config.sort=!0,e.ext.zoom.init(ye)},Ce=function(e,t){e.attachEvent("onTaskDblClick",(function(e,n){!function(e,t){I(t)&&de(e,t),X(t)&&be(e,t)}(e,t.git_url)})),e.attachEvent("onTaskCreated",(function(e,n){var a;a=t.git_url,I(a)&&fe(0,a),X(a)&&ve(0,a)})),e.attachEvent("onAfterTaskUpdate",(function(n,a){we(a,t.token,e,t.git_url)}))},De=function(e){var t=Object(a.useRef)(null);return Object(a.useEffect)((function(){je(j.gantt),Ce(j.gantt,e),j.gantt.init(t.current),j.gantt.ext.zoom.setLevel(e.zoom),j.gantt.clearAll(),_e((function(e){j.gantt.parse(e),j.gantt.sort("start_date",!1)}),e.git_url,e.token,e.selected_labels)}),[]),Object(a.useEffect)((function(){j.gantt.ext.zoom.setLevel(e.zoom)}),[e.zoom]),Object(a.useEffect)((function(){j.gantt.clearAll(),_e((function(e){j.gantt.parse(e),j.gantt.sort("start_date",!1)}),e.git_url,e.token,e.selected_labels)}),[e.git_url,e.token,e.selected_labels,e.update]),r.a.createElement("div",{ref:t,style:{width:"100%",height:"100%"}})},Le=(n(115),De),Se=n(66),Ee={currentZoom:"Weeks",update:0,git_url:"",token:"Tokens that have not yet been entered",labels:[],selected_labels:[]},Oe=function(e,t){switch(t.type){case"zoomChange":return Object(s.a)({},e,{currentZoom:xe(t.value)});case"gitURLChange":return Object(s.a)({},e,{git_url:Ae(t.value.props,t.value.git_url,e.selected_labels)});case"tokenChange":return Object(s.a)({},e,{token:t.value});case"labelChange":return Object(s.a)({},e,{labels:t.value});case"selectedLabelsChange":return Object(s.a)({},e,{selected_labels:ze(t.value.props,e.git_url,t.value.selected_labels)});case"updateClick":return Object(s.a)({},e,{update:e.update+1});case"setStateFromURLQueryString":return Re(e,t.value.props,t.value.setValue);default:return e}},xe=function(e){return Object(Se.bake_cookie)("currentZoom",e),e},Ae=function(e,t,n){var a=new URLSearchParams(e.location.search);return a.set("giturl",t),a.set("labels",W(n)),e.history.push({search:a.toString()}),t},ze=function(e,t,n){var a=new URLSearchParams(e.location.search);return a.set("giturl",t),a.set("labels",W(n)),e.history.push({search:a.toString()}),n},Re=function(e,t,n){var a=new URLSearchParams(t.location.search);return e.git_url=a.get("giturl"),e.selected_labels=function(e){var t=[];if(O(e)){var n=e.split(",");n.forEach((function(e,a,r){if(a<n.length-1){var o=e.split(":"),u={id:o[0],name:o[1]};t.push(u)}}))}return t}(a.get("labels")),n("git_url",e.git_url),e},Pe=Object(i.e)((function(e){var t=Object(a.useReducer)(Oe,Ee),n=Object(l.a)(t,2),o=n[0],u=n[1],c=Object(d.a)(),i=c.register,s=c.handleSubmit,f=c.setValue;return Object(a.useEffect)((function(){console.log("location"),u({type:"setStateFromURLQueryString",value:{props:e,setValue:f}})}),[e.location]),Object(a.useEffect)((function(){console.log("aa"),ke((function(e){u({type:"labelChange",value:e})}),o.git_url,o.labels,o.token)}),[o.git_url]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"zoom-bar"},r.a.createElement(y,{zoom:o.currentZoom,onZoomChange:function(e){return u({type:"zoomChange",value:e})},onGitURLChange:function(t){return u({type:"gitURLChange",value:{props:e,git_url:t}})},token:o.token,onTokenChange:function(e){return u({type:"tokenChange",value:e})},onUpdateClick:function(){return u({type:"updateClick"})},labels:o.labels,selected_labels:o.selected_labels,onSelectedLabelChange:function(t){return u({type:"selectedLabelsChange",value:{props:e,selected_labels:t}})},handleSubmit:s((function(e){return console.log(e)})),register:i})),r.a.createElement("div",{className:"gantt-container"},r.a.createElement(Le,{zoom:o.currentZoom,git_url:o.git_url,token:o.token,selected_labels:o.selected_labels,update:o.update})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(c.a,null,r.a.createElement(i.a,{render:function(e){return r.a.createElement(Pe,null)}})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},76:function(e,t,n){e.exports=n(120)},81:function(e,t,n){},94:function(e,t,n){}},[[76,1,2]]]);
//# sourceMappingURL=main.23e556b1.chunk.js.map