(this["webpackJsonpreact-issue-ganttchart"]=this["webpackJsonpreact-issue-ganttchart"]||[]).push([[0],{143:function(e,t,n){},153:function(e,t,n){},230:function(e,t,n){},233:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var r,a=n(0),s=n(13),u=n.n(s),i=n(79),l=n(15),c=(n(143),n(28)),o=n(125),d=n(7),p=n(5),f=n(289),g=n(117),b=n.n(g),h=n(291),v=n(253),m=n(290),_=n(115),j=n(292),k=n(118),y=n.n(k),O=n(4),x={multiselectContainer:{width:"27%",display:"inline-block",verticalAlign:"middle",padding:"4px",alignItems:"flex-end"},chips:{background:"light blue",fontSize:"15px"},searchBox:{border:"none"}},w=Object(p.a)((function(e){return{root:{"& > *":{fontSize:"13px",marginRight:"4px"}}}}))((function(e){var t=e.classes;return Object(O.jsxs)("form",{noValidate:!0,children:[Object(O.jsx)(h.a,{className:t.root,required:!0,placeholder:"https://github.com/lamact/react-issue-ganttchart",label:"Git Repository URL",style:{width:"25%",verticalAlign:"middle"},onChange:function(t){e.onGitURLChange(t.target.value)},inputRef:e.register,name:"git_url"}),Object(O.jsx)(h.a,{className:t.root,type:"password",placeholder:"Access Token",label:"Access Token",style:{width:"10%",verticalAlign:"middle"},onChange:function(t){e.onTokenChange(t.target.value)},inputRef:e.register,name:"token"}),Object(O.jsx)(_.Multiselect,{className:t.root,options:e.labels,selectedValues:e.selected_labels,onSelect:function(t){e.onSelectedLabelChange(t)},onRemove:function(t){e.onSelectedLabelChange(t)},displayValue:"name",style:x,placeholder:"filter by labels",hidePlaceholder:"false",emptyRecordMsg:"No Labels",closeIcon:"cancel"}),Object(O.jsx)(j.a,{className:t.root,size:"small",options:e.member_list,getOptionLabel:function(e){return e.name},value:e.selected_assignee,noOptionsText:"Requires a valid token",onChange:function(t,n){e.onSelectedAssigneeChange(n)},style:{width:"10%",verticalAlign:"middle",display:"inline-block",marginRight:"15px"},renderInput:function(e){return Object(O.jsx)(h.a,Object(d.a)(Object(d.a)({},e),{},{className:t.root,label:"Assignee",variant:"standard"}))}}),Object(O.jsxs)(m.a,{size:"small",style:{height:"34px"},children:[Object(O.jsx)(v.a,{onClick:function(t){e.onScreenChange("Gantt")},children:"Gantt"}),Object(O.jsx)(v.a,{onClick:function(t){e.onScreenChange("Table")},children:"Table"})]}),Object(O.jsx)(f.a,{color:"primary",style:{verticalAlign:"middle"},children:Object(O.jsx)(b.a,{onClick:function(t){e.onUpdateClick()}})}),Object(O.jsx)(f.a,{color:"primary",style:{verticalAlign:"middle"},children:Object(O.jsx)(y.a,{onClick:function(){return window.open("https://github.com/lamact/react-issue-ganttchart")}})})]})})),D=(n(153),w),C=n(16),T=(n(154),n(155),n(227),n(56)),A=n.n(T),I=function(e){return null!==e&&void 0!==e&&""!==e||!!Array.isArray(e)&&e.length>0},S=function(e){return I(e)&&"id"in e&&"name"in e},L=function(e){return!!I(e)&&/https:\/\//.test(e)},P=function(e,t){return Math.round(e/t)*t},R=function(e,t){var n=A()(e,"YYYY/MM/DD");return A()(t,"YYYY/MM/DD").diff(n,"days")+1},N=function(e,t){var n=new Date(e),r=A()(n,"YYYY/MM/DD").add(t-1,"d").toDate();return z(r)},B=function(e){return"string"===typeof e?e:z(e)},z=function(e){if("[object Date]"!==Object.prototype.toString.call(e))return null;if(isNaN(e.getFullYear()))return null;var t=e.toLocaleDateString("ja-JP");/\d{4}\/\d{1,2}\/\d{1,2}/.test(t)||(t=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate());return t},M=function(e){return z(new Date(e))},Y=function(e,t,n){return null!=e&&null!=t?z(e):M(n)},E=function(e,t,n){return null!=e&&null!=t?new Date(t):new Date(n)},U=function(e,t){return M(null!=t?t:e)},G=function(e,t){return null!=e&&null!=t?R(e,t):1},F=function(e,t){if(!1 in t)return null;if(0===t.parent)return null;var n=e.getTask(t.parent).valueOf();n.start_date.getTime()>t.start_date.getTime()&&(n.start_date=t.start_date,e.updateTask(n.id,n),e.render()),n.end_date.getTime()<t.end_date.getTime()&&(n.end_date=t.end_date,e.updateTask(n.id,n),e.render())},H=function(e,t,n){var r=e.getTask(n).valueOf(),a=r.duration.valueOf();r.start_date.getTime()<t.start_date.getTime()&&(r.start_date=t.start_date,r.end_date=new Date(N(t.start_date,a)),e.updateTask(r.id,r),e.render()),r.end_date.getTime()>t.end_date.getTime()&&(r.start_date=new Date(function(e,t){var n=new Date(e),r=A()(n,"YYYY/MM/DD").add(-t,"d").toDate();return z(r)}(t.end_date,a)),r.end_date=t.end_date,e.updateTask(r.id,r),e.render())},V={levels:[{name:"Days",scale_height:30,min_column_width:25,scales:[{unit:"month",step:1,format:"%n"},{unit:"day",step:1,format:"%d"}]}]},J=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?null:("00"+(e.getMonth()+1)).slice(-2)+"/"+("00"+e.getDate()).slice(-2)},$=function(e){var t=Object(a.useRef)(null);return Object(a.useEffect)((function(){var n;(n=C.gantt).config.xml_date="%Y/%m/%d %H:%i",n.config.order_branch=!0,n.config.order_branch_free=!0,n.config.keep_grid_width=!0,n.config.grid_resize=!0,n.config.open_tree_initially=!0,n.config.fit_tasks=!0,n.config.sort=!0,n.config.columns=[{name:"id",label:"No.",align:"left",tree:!0,width:"120",template:function(e){var t=new Date;return t.setDate(t.getDate()-7),e.update<t.toLocaleDateString()?e.id+"<a title='There is no update for a week.'><span class='overdue'>i</span></a>":e.id}},{name:"start_date",label:"Start ",align:"center",width:"60",template:function(e){return J(e.start_date)}},{name:"due_date",label:"Due ",align:"center",width:"60",template:function(e){return J(e.due_date)}},{name:"assignee",label:"Assignee",align:"center",width:"130"},{name:"add",label:"",width:"40"}],n.plugins({drag_timeline:!0}),n.showDate(new Date),n.ext.zoom.init(V),function(e){e.templates.timeline_cell_class=function(e,t){if("[object Date]"!==Object.prototype.toString.call(t))return null;var n=new Date;if(t.getDate()===n.getDate()&&t.getMonth()===n.getMonth())return"today";if(0===t.getDay()||6===t.getDay())return"weekend";var r=new Date;return r.setDate(r.getDate()-1),t<r?"past_days":void 0},e.templates.task_text=function(e,t,n){return n.text},e.templates.task_class=function(e,t,n){if(1==n.progress)return"";if(n.progress<.01){if(e<=new Date)return"behind"}else if(new Date(N(e,(R(e,t)+1)*n.progress))<new Date)return"behind"}}(C.gantt),function(e,t){e.attachEvent("onTaskDblClick",(function(e,n){t.openIssueAtBrowser(e)})),e.attachEvent("onTaskCreated",(function(e,n){t.openNewIssueAtBrowser(e)})),e.attachEvent("onAfterTaskUpdate",(function(n,r){F(e,r),e.getChildren(r.id).map((function(t){H(e,r,t)})),t.updateIssueByAPI(r,e)})),e.attachEvent("onBeforeTaskUpdate",(function(e,t,n){})),e.attachEvent("onAfterTaskMove",(function(n,r){var a=e.getTask(n);"parent"in a&&0!==a.parent&&(a.parent=r,t.updateIssueByAPI(a,e))})),e.attachEvent("onAfterLinkAdd",(function(t,n){var r=[],a=[],s=n.target;e.getTask(s).$target.forEach((function(t){var n=e.getLink(t),s=n.target,u=n.source;a.push({type:"0",target:s,source:u});var i=u.slice(1);""!=i&&r.push(i)})),e.getTask(s).dependon=r,e.getTask(s).links=a,e.updateTask(s)})),e.attachEvent("onAfterLinkDelete",(function(t,n){var r=[],a=[],s=n.target;e.getTask(s).$target.forEach((function(t){var n=e.getLink(t),s=n.target,u=n.source;a.push({type:"0",target:s,source:u});var i=u.slice(1);""!=i&&r.push(i)})),e.getTask(s).dependon=r,e.getTask(s).links=a,e.updateTask(s)})),e.attachEvent("onTaskDrag",(function(t,n,r,a){var s,u=e.getState(),i=u.min_date,l=u.max_date,c=e.date.add(new Date,u.scale_step,u.scale_unit)-new Date,o=!1;"resize"!=n&&"move"!=n||(Math.abs(r.start_date-i)<c?(s=r.start_date,o=!0):Math.abs(r.end_date-l)<c&&(s=r.end_date,o=!0),o&&(e.render(),e.showDate(s)))}))}(C.gantt,e),C.gantt.init(t.current),C.gantt.ext.zoom.setLevel("Days")}),[]),Object(a.useEffect)((function(){try{C.gantt.clearAll(),I(e.issue)&&(e.issue.map((function(e){C.gantt.addTask(e),"links"in e&&e.links.map((function(e){return C.gantt.addLink(e),null}))})),C.gantt.sort("due_date",!1))}catch(t){C.gantt.message({text:t,type:"error"})}}),[e.issue]),Object(O.jsx)("div",{ref:t,style:{width:"100%",height:"100%"}})},q=(n(230),$),Q=(n(126),n(119)),W=n(120),X=n(57),K=(n(232),n(127)),Z=W.a.div(r||(r=Object(Q.a)(["\n  padding: 1rem;\n\n  table {\n    display: inline-block; \n    border-spacing: 0;\n    border: 1px solid black;\n\n    tr {\n      :last-child {\n        td {\n          border-bottom: 0;\n        }\n      }\n    }\n\n    th,\n    td {\n      margin: 0;\n      padding: 0.5rem;\n      border-bottom: 1px solid black;\n      border-right: 1px solid black;\n\n      position: relative;\n\n      .resizer {\n        display: inline-block;\n        background: black;\n        width: 1px;\n        height: 100%;\n        position: absolute;\n        right: 0;\n        top: 0;\n        transform: translateX(50%);\n        z-index: 1;\n        ","\n        touch-action:none;\n\n        &.isResizing {\n          background: red;\n        }\n\n      :last-child {\n        border-right: 0;\n      }\n    }\n  }\n"])),"");function ee(e){var t=e.columns,n=e.data,r=Object(X.useTable)({columns:t,data:n},X.useSortBy,X.useBlockLayout,X.useResizeColumns),a=r.getTableProps,s=r.getTableBodyProps,u=r.headerGroups,i=r.rows,l=r.prepareRow;r.allColumns,r.getToggleHideAllColumnsProps,r.state;return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)(K.a,Object(d.a)(Object(d.a)({striped:!0,bordered:!0,hover:!0,size:"sm"},a()),{},{children:[Object(O.jsx)("thead",{children:u.map((function(e){return Object(O.jsx)("tr",Object(d.a)(Object(d.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(O.jsxs)("th",Object(d.a)(Object(d.a)({},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),Object(O.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""}),Object(O.jsx)("div",Object(d.a)(Object(d.a)({},e.getResizerProps()),{},{className:"resizer ".concat(e.isResizing?"isResizing":"")}))]}))}))}))}))}),Object(O.jsx)("tbody",Object(d.a)(Object(d.a)({},s()),{},{children:i.map((function(e,t){return l(e),Object(O.jsx)("tr",Object(d.a)(Object(d.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(O.jsx)("td",Object(d.a)(Object(d.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})}var te=function(e,t){if("undefined"===typeof e.issue_columns[0]||"undefined"===typeof e.issue)return!1;var n=[];return e.issue.map((function(e){var t=Object(d.a)(Object(d.a)({},e),{},{start_date:B(e.start_date),end_date:B(e.end_date),due_date:B(e.due_date),links:""});n.push(t)})),Object(O.jsx)(Z,{children:Object(O.jsx)(ee,{columns:e.issue_columns[0].columns,data:n})})},ne=function(e){return Object(O.jsx)("div",{children:te(e)})},re=(n(233),ne),ae=n(55),se=n(80),ue=function(e){return e.length>1&&/^#/.test(e)&&(e=e.substring(1)),e},ie=function(e){return e.length>1&&/ +$/.test(e)&&(e=e.slice(0,-1)),e},le=function(e){if(null===e)return null;var t=function(e){if(null===e)return null;if("string"!==typeof e)return null;var t=e.split(/^```yaml/);return null===t||t.length<2||null===(t=t[1].split(/```/))||t.length<2?null:t[0]}(e);if(null===t)return null;var n=null;try{n=se.a.load(t)}catch(r){C.gantt.message({text:"failed load yaml"+t,type:"error"})}return n},ce=function(e,t){if(null===e)return null;var n=le(e);if(null===n||!(t in n))return null;var r=n[t];return"number"!==typeof r?null:r},oe=function(e,t){if(null===e)return null;var n=function(e,t){if(null===e)return null;var n=le(e);if(null===n||!(t in n))return null;var r=n[t];return"string"!==typeof r?null:ie(ie(r))}(e,t);return/\d{4}\/\d{1,2}\/\d{1,2}/.test(n)?new Date(n):null},de=function(e,t){if(null===e||null===t)return null;var n=se.a.dump(t);n="```yaml\n"+n+"```";var r=e.split(/^```yaml/);if(null===r||r.length<2)return/```/.test(e)?null:n+"\n"+e;var a=r[0];if(null===(r=r[1].split(/```/))||r.length<2)return null;var s=r[1];return null==a||null==s?null:a+n+s},pe=function(e){var t="";return I(e)?(e.map((function(e){return S(e)&&I(e.id)&&(t+=e.id+":"+e.name+","),null})),t):null},fe=function(e){var t=[];if(I(e)){var n=e.split(",");n.forEach((function(e,r,a){if(r<n.length-1){var s=e.split(":");if(!isNaN(parseInt(s[0]))){var u={id:parseInt(s[0]),name:s[1]};t.push(u)}}}))}else t=[{id:0,name:""}];return t},ge=function(e,t){if(null===e)return null;var n=le(e);return null!==n&&t in n?n[t]:null},be=n(9),he=n.n(be),ve=n(14),me="https://api.github.com/repos/",_e="https://github.com/",je=function(e){return!!L(e)&&(!(e.split("/").length<5)&&/github\.com/.test(e))},ke=function(e){if(!je(e))return null;var t=e.split("/");return t.length>=5?t[3]:null},ye=function(e){if(!je(e))return null;var t=e.split("/");return t.length>=5?t[4]:null},Oe=function(e,t){return je(e)&&I(t)?me+ke(e)+"/"+ye(e)+"/issues/"+t:null},xe=function(e,t,n){if(!je(e)||!I(t)||!I(n))return null;var r="?";return r+="labels=",t.map((function(e){S(e)&&(r+=e.name+",")})),S(n)&&""!==n.name&&(r+="&assignee="+n.name),me+ke(e)+"/"+ye(e)+"/issues"+r},we=function(e){return je(e)?me+ke(e)+"/"+ye(e)+"/labels":null},De=function(e){return je(e)?me+ke(e)+"/"+ye(e)+"/collaborators":null},Ce=function(e,t){return je(e)&&I(t)?("number"===typeof(n=t)&&Number.isFinite(n)||(t=ue(t)),t<=0?null:_e+ke(e)+"/"+ye(e)+"/issues/"+t):null;var n},Te=function(e){return!!L(e)&&(!(e.split("/").length<5)&&/gitlab\.com/.test(e))},Ae=function(e){if(je(e))return null;if(!L(e))return null;var t=e.split("/");return t.length>=5?t[2]:null},Ie=function(e){if(!L(e))return null;var t=null,n=Ae(e);return null!==n&&(t="https://"+n+"/"),t},Se=function(e){return L(e)?Ie(e):null},Le=function(e){return L(e)?Ie(e)+"api/v4/":null},Pe=function(e){if(!L(e))return null;var t=e.split("/");return t.length>=5?t[3]:null},Re=function(e){if(!L(e))return null;var t=e.split("/");return t.length>=5?t[4]:null},Ne=function(e){var t="?";return I(e)&&"Tokens that have not yet been entered"!==e&&(t+="access_token="+e),t},Be=function(e,t,n,r){if(!L(e))return null;if(!I(t))return null;if(!I(n))return null;if(!S(r))return null;var a=Ne(t);return I(n)&&(a+="&labels=",n.map((function(e){return S(e)&&(a+=e.name+","),null}))),S(r)&&""!==r.name&&(a+="&assignee_id="+r.id),a+="&per_page=100&state=opened",Le(e)+"projects/"+Pe(e)+"%2F"+Re(e)+"/issues"+a},ze=function(e,t,n){if(!L(e))return null;if(!I(t))return null;if(!I(n))return null;var r=Ne(t);return Le(e)+"projects/"+Pe(e)+"%2F"+Re(e)+"/issues/"+n+r},Me=function(e,t){if(!L(e))return null;var n=Ne(t);return n+="&per_page=100",Le(e)+"projects/"+Pe(e)+"%2F"+Re(e)+"/labels"+n},Ye=function(e,t){if(!L(e))return null;var n=Ne(t);return Le(e)+"groups/"+Pe(e)+"/members/all"+n},Ee=n(25),Ue=n.n(Ee),Ge=function(e){return null!==e.assignee?e.assignee.login:""},Fe=function(e,t){for(var n=oe(e,"start_date"),r=oe(e,"due_date"),a={id:"#"+t.number,text:t.title,start_date:Y(n,r,t.created_at),due_date:E(n,r,t.created_at),duration:G(n,r),progress:ce(e,"progress"),assignee:Ge(t),parent:"#"+ce(e,"parent"),description:e,update:U(t.created_at,t.updated_at)},s=le(t.description),u=0,i=Object.entries(s);u<i.length;u++){var l=Object(c.a)(i[u],2),o=l[0],d=l[1];o in a||(a[o]=d)}return a},He=function(e){var t,n=[];if(null!=(t=ge(e.body,"dependon"))){for(var r=0;r<t.length;r++){var a=[];a.type="0",a.target="#"+e.number,a.source="#"+t[r],n.push(a)}return n}},Ve=function(e,t){var n=M(t.start_date).replace(/\-/g,"/"),r={start_date:n,due_date:N(n,t.duration).replace(/\-/g,"/"),progress:P(t.progress,.01)};return"parent"in t&&(r.parent=parseInt(ue(t.parent))),"dependon"in t&&(r.dependon=t.dependon),e=de(e,r)},Je=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ue.a.get(Oe(t,n.number)).then((function(e){var t=[],r=Fe(e.data.body,n),a=He(n);if("undefined"!=typeof a)for(var s=0;s<a.length;s++){var u={type:a[s].type,target:a[s].target,source:a[s].source};t.push(u)}return r.links=t,r})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$e=function(){var e=Object(ve.a)(he.a.mark((function e(t,n,r){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ue.a.get(xe(t,n,r)).then((function(e){var n=[];return e.data.map((function(e){n.push(Je(t,e))})),Promise.all(n)})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),qe=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ue.a.get(we(t)).then((function(e){var t=[];return e.data.map((function(e){return t.push({id:e.id,name:e.name}),null})),t})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Qe=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I(n)||"Tokens that have not yet been entered"===n){e.next=4;break}return e.abrupt("return",Ue.a.get(De(t),{headers:{Authorization:"token ".concat(n)},data:{}}).then((function(e){var t=[];return e.data.map((function(e){return t.push({id:e.id,name:e.login}),null})),t})));case 4:console.warn("token is not valid!");case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),We=function(e,t,n,r){var a=Oe(r,ue(e.id));return Ue.a.get(a).then((function(r){var s,u,i,l=r.data;null==Ve(l.body,e)?n.message({text:"failed update issue. "+e.text,type:"error"}):1!=(s=function(e){var t=[];return e.links.map((function(e){var n=[];n.type=e.type,n.target=e.target,n.source=e.source,t.push(n)})),{id:e.id,text:e.text,start_date:M(e.start_date),due_date:e.due_date,duration:e.duration,progress:e.progress,assignee:e.assignee,description:e.description,update:e.update,links:t,parent:"#"+e.parent}}(e),u=Fe(l.body,l),i=He(l),s.id==u.id&&s.text==u.text&&s.start_date==u.start_date&&s.due_date==u.due_date.toString()&&s.duration==u.duration&&s.progress==u.progress&&s.assignee==u.assignee&&s.description==u.description&&s.update==u.update&&s.parent==u.parent&&s.links.toString()==i.toString())&&Ue.a.post(a,{body:Ve(l.body,e)},{headers:{Authorization:"token ".concat(t)}}).then((function(t){n.message({text:"success update issue.  "+e.id})})).catch((function(e){n.message({text:"failed update GitHub issue. check your token."+e,type:"error"})}))})).catch((function(e){n.message({text:"failed get GitHub issue. check your url."+e,type:"error"}),$e(n,r)})),null},Xe=function(e,t){var n=z(new Date),r=z(new Date);null==e.parent&&(e.parent=0);var a={start_date:n,due_date:r,progress:.1,parent:parseInt(ue(e.parent))},s=de("",a);s=encodeURIComponent(s),window.open(function(e){return je(e)?_e+ke(e)+"/"+ye(e)+"/issues/new?assignees=&labels=&title=&body=":null}(t)+s,"_blank")},Ke=function(e){return I(e)&&"assignee"in e&&I(e.assignee)&&"name"in e.assignee?e.assignee.name:""},Ze=function(e){var t=oe(e.description,"start_date"),n=M(e.due_date),r={id:"#"+e.iid,text:e.title,start_date:Y(t,n,e.created_at),due_date:E(t,n,e.created_at),duration:G(t,n),progress:ce(e.description,"progress"),assignee:Ke(e),description:e.description,update:U(e.created_at,e.updated_at)},a=ce(e.description,"parent");null!==a&&0!==a&&(r.parent="#"+a);var s=le(e.description);if(s)for(var u=0,i=Object.entries(s);u<i.length;u++){var l=Object(c.a)(i[u],2),o=l[0],d=l[1];o in r||(r[o]=d)}var p=[],f=et(e);if("undefined"!=typeof f)for(var g=0;g<f.length;g++){var b={type:f[g].type,target:f[g].target,source:f[g].source};p.push(b)}return r.links=p,r},et=function(e){var t,n=[];if(null!=(t=ge(e.description,"dependon"))){for(var r=0;r<t.length;r++){var a=[];a.type="0",a.target="#"+e.iid,a.source="#"+t[r],n.push(a)}return n}},tt=function(){var e=Object(ve.a)(he.a.mark((function e(t,n,r,a){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ue.a.get(Be(t,n,r,a)).then((function(e){var t=[];return e.data.map((function(e){var n=Ze(e);t.push(n)})),t})).catch((function(e){return console.error(e),Promise.reject(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),nt=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ue.a.get(Me(t,n)).then((function(e){var t=[];return e.data.map((function(e){return t.push(e),null})),t})).catch((function(e){return console.error(e),Promise.reject(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),rt=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ue.a.get(Ye(t,n)).then((function(e){var t=[];return e.data.map((function(e){return t.push({id:e.id,name:e.name}),null})),t})).catch((function(e){return console.error(e),Promise.reject(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),at=function(e,t,n,r){return Ue.a.get(ze(r,t,ue(e.id))).then((function(a){var s,u,i=a.data;if(1!=(s=function(e){var t=[];return e.links.map((function(e){t.push({type:e.type,target:e.target,source:e.source})})),{id:e.id,text:e.text,start_date:M(e.start_date),due_date:e.due_date,duration:e.duration,progress:e.progress,assignee:e.assignee,description:e.description,update:e.update,parent:e.parent,links:t}}(e),u=Ze(i),s.id==u.id&&s.text==u.text&&s.start_date==u.start_date&&s.due_date==u.due_date.toString()&&s.duration==u.duration&&s.progress==u.progress&&s.assignee==u.assignee&&s.description==u.description&&s.update==u.update&&s.parent==u.parent&&JSON.stringify(s.links)==JSON.stringify(u.links))&&parseInt(i.iid)===parseInt(ue(e.id))){var l=function(e,t){var n={start_date:M(t.start_date).replace(/\-/g,"/"),progress:P(t.progress,.01)};return"parent"in t&&(n.parent=parseInt(ue(t.parent))),"dependon"in t&&(n.dependon=t.dependon),de(e,n)}(i.description,e);if(null!=l){l=encodeURIComponent(l);var c=M(e.start_date),o=N(c,e.duration),d=ze(r,t,ue(e.id))+"&description="+l+"&due_date="+o;return Ue.a.put(d).then((function(t){n.message({text:"success update issue.  "+e.id})})).catch((function(e){return console.error(e),Promise.reject(e)}))}n.message({text:"failed update issue. "+e.text,type:"error"})}})).catch((function(e){n.message({text:"failed get GitLab issue. check your token.",type:"error"})}))},st=function(e,t){window.open(function(e,t){return L(e)?Se(e)+Pe(e)+"/"+Re(e)+"/-/issues/"+t:null}(t,ue(e)),"_blank")},ut=function(e,t){var n=z(new Date);null==e.parent&&(e.parent=0);var r={start_date:n,progress:.1,parent:parseInt(ue(e.parent))},a=de("",r);a=encodeURIComponent(a),window.open(function(e){return L(e)?Se(e)+Pe(e)+"/"+Re(e)+"/issues/new?issue[description]=":null}(t)+a,"_blank")},it=function(){var e=Object(ve.a)(he.a.mark((function e(t,n,r,a){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(t)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(!je(t)){e.next=8;break}return e.abrupt("return",$e(t,r,a));case 8:if(!Te(t)&&null===Ae(t)){e.next=10;break}return e.abrupt("return",tt(t,n,r,a));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),lt=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(t)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(!je(t)){e.next=8;break}return e.abrupt("return",qe(t,n));case 8:if(!Te(t)&&null===Ae(t)){e.next=10;break}return e.abrupt("return",nt(t,n));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ct=function(){var e=Object(ve.a)(he.a.mark((function e(t,n){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(t)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(!je(t)){e.next=8;break}return e.abrupt("return",Qe(t,n));case 8:if(!Te(t)&&null===Ae(t)){e.next=10;break}return e.abrupt("return",rt(t,n));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ot=function(e,t){if(!L(t))return Promise.resolve();je(t)?function(e,t){window.open(Ce(t,ue(e)),"_blank")}(e,t):(Te(t)||null!==Ae(t))&&st(e,t)},dt={screen:"Table",update:0,git_url:"",token:Object(ae.read_cookie)("git_token"),labels:[],selected_labels:[],member_list:[],selected_assignee:{},issue:[],issue_columns:[],initflag:!1},pt=function(e,t){switch(t.type){case"screenChange":return Object(d.a)(Object(d.a)({},e),{},{screen:t.value});case"gitURLChange":return Object(d.a)(Object(d.a)({},e),{},{git_url:vt(t.value.props,t.value.git_url,e.selected_labels)});case"tokenChange":return Object(d.a)(Object(d.a)({},e),{},{token:mt(t.value)});case"labelChange":return Object(d.a)(Object(d.a)({},e),{},{labels:t.value});case"selectedLabelsChange":return Object(d.a)(Object(d.a)({},e),{},{selected_labels:_t(t.value.props,e.git_url,t.value.selected_labels,e.selected_assignee)});case"memberListChange":return Object(d.a)(Object(d.a)({},e),{},{member_list:jt(t.value)});case"selectedAssigneeChange":return Object(d.a)(Object(d.a)({},e),{},{selected_assignee:kt(t.value.props,e.git_url,e.selected_labels,t.value.selected_assignee)});case"updateClick":return Object(d.a)(Object(d.a)({},e),{},{update:e.update+1});case"openIssueAtBrowser":return ft(e,t);case"openNewIssueAtBrowser":return gt(e,t);case"updateIssueByAPI":return bt(e,t);case"setIssue":return ht(e,t);case"initFlagTrue":return Object(d.a)(Object(d.a)({},e),{},{initflag:!0});case"setStateFromURLQueryString":return Ot(e,t.value.props,t.value.setValue);default:return e}},ft=function(e,t){return ot(t.value,e.git_url),e},gt=function(e,t){return function(e,t){if(!L(t))return null;je(t)?Xe(e,t):(Te(t)||null!==Ae(t))&&ut(e,t)}(t.value,e.git_url),e},bt=function(e,t){var n,r,a,s;return n=t.value.gantt_task,r=e.token,a=t.value.gantt,s=e.git_url,L(s)?je(s)?We(n,r,a,s):(Te(s)||null!==Ae(s))&&at(n,r,a,s):Promise.resolve(),e},ht=function(e,t){if(I(t.value)&&0!==t.value.length){var n=[];t.value.map((function(e){n=n.concat(Object.keys(e));for(var t=0;t<n.length;++t)for(var r=t+1;r<n.length;++r)n[t]===n[r]&&n.splice(r--,1);return null}));var r=[];n.map((function(e){var n=e.length;return t.value.map((function(t){var r=0;try{r=t[e].length}catch(a){}isNaN(n)?r=0:n<r&&(n=r)})),(n=20+9*n)>150&&(n=150),"text"===e?r.push({accessor:"text",Header:"title",width:n}):"description"===e||"links"===e||r.push({accessor:e,Header:e,width:n}),null}));var a=[{Header:"Info",columns:r}];return Object(d.a)(Object(d.a)({},e),{},{update:e.update+1,issue_columns:a,issue:t.value})}return Object(d.a)(Object(d.a)({},e),{},{issue:t.value})},vt=function(e,t,n,r){var a;if((a=ie(t)).length>1&&/\/$/.test(a)&&(a=a.slice(0,-1)),je(t=a))C.gantt.message({text:"Access GitHub.com"});else if(Te(t))C.gantt.message({text:"Access GitLab.com"});else if(null!==Ae(t))C.gantt.message({text:"Access Maybe GitLab.self-host"});else if(""!==t)return C.gantt.message({text:"Not a valid URL.",type:"error"}),null;return yt(e,t,n,r),t},mt=function(e){return Object(ae.bake_cookie)("git_token",e),e},_t=function(e,t,n,r){return yt(e,t,n,r),n},jt=function(e){return I(e)?e:[]},kt=function(e,t,n,r){return yt(e,t,n,r),r},yt=function(e,t,n,r){var a=new URLSearchParams(e.location.search);return a.set("giturl",t),a.set("labels",pe(n)),a.set("assignee",pe([r])),e.history.push({search:a.toString()}),null},Ot=function(e,t,n){var r=new URLSearchParams(t.location.search);e.git_url=r.get("giturl");var a=fe(r.get("labels"));I(a[0])&&"name"in a[0]&&""!==a[0].name&&(e.selected_labels=a);var s=fe(r.get("assignee"));return I(s)&&(e.selected_assignee=s[0]),n("git_url",e.git_url),e},xt=Object(l.e)((function(e){var t=Object(o.a)({git_url:"",token:""}),n=t.register,r=t.setValue,s=Object(a.useReducer)(pt,Ot(dt,e,r)),u=Object(c.a)(s,2),i=u[0],l=u[1];return r("token",Object(ae.read_cookie)("git_token")),Object(a.useEffect)((function(){i.initflag?l({type:"setStateFromURLQueryString",value:{props:e,setValue:r}}):l({type:"initFlagTrue"})}),[e.location]),Object(a.useEffect)((function(){lt(i.git_url,i.token).then((function(e){l({type:"labelChange",value:e})})).catch((function(e){C.gantt.message({text:e,type:"error"})})),ct(i.git_url,i.token).then((function(e){l({type:"memberListChange",value:e})})).catch((function(e){C.gantt.message({text:e,type:"error"})}))}),[i.git_url,i.token,i.selected_assignee]),Object(a.useEffect)((function(){it(i.git_url,i.token,i.selected_labels,i.selected_assignee).then((function(e){l({type:"setIssue",value:e})})).catch((function(e){console.log("error",e)}))}),[i.token,i.git_url,i.selected_labels,i.selected_assignee]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{children:Object(O.jsx)(D,{onScreenChange:function(e){return l({type:"screenChange",value:e})},onGitURLChange:function(t){return l({type:"gitURLChange",value:{props:e,git_url:t}})},token:i.token,onTokenChange:function(e){return l({type:"tokenChange",value:e})},onUpdateClick:function(){return l({type:"updateClick"})},labels:i.labels,selected_labels:i.selected_labels,onSelectedLabelChange:function(t){return l({type:"selectedLabelsChange",value:{props:e,selected_labels:t}})},member_list:i.member_list,selected_assignee:i.selected_assignee,onSelectedAssigneeChange:function(t){return l({type:"selectedAssigneeChange",value:{props:e,selected_assignee:t}})},register:n})}),Object(O.jsx)("div",{children:"Gantt"===i.screen?Object(O.jsx)("div",{className:"gantt-container",children:Object(O.jsx)(q,{git_url:i.git_url,token:i.token,selected_labels:i.selected_labels,selected_assignee:i.selected_assignee,issue:i.issue,update:i.update,openIssueAtBrowser:function(e){return l({type:"openIssueAtBrowser",value:e})},openNewIssueAtBrowser:function(e){return l({type:"openNewIssueAtBrowser",value:e})},updateIssueByAPI:function(e,t){return l({type:"updateIssueByAPI",value:{gantt_task:e,gantt:t}})}})}):Object(O.jsx)("div",{className:"gantt-container",children:Object(O.jsx)(re,{issue:i.issue,issue_columns:i.issue_columns})})})]})}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(Object(O.jsx)(i.a,{children:Object(O.jsx)(l.a,{render:function(e){return Object(O.jsx)(xt,{})}})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[252,1,2]]]);
//# sourceMappingURL=main.d9351782.chunk.js.map